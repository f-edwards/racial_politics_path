---
title: "Varying paths to building the social state in the progressive era"
author: "Frank Edwards"
date: "2023-08-15"
output: bookdown::html_document2
---

```{r setup, include = F, message = F}
knitr::opts_chunk$set(message = F, echo = F, warning = F)
library(tidyverse)
library(lme4)
library(maps)
library(usmap)
library(grid)
library(gridExtra)
options(scipen = 999)
options(dplyr.print_max = 1e9)
map<-map_data("state")

theme_set(theme_minimal())
```

# Theoretical framework

(GENERAL FRAMEWORK: Racial capitalism / settler colonization) MATERIAL CONDITIONS FOR SETTLER COLONIZATION STRUCTURE POLICY DESIGN. socio-political processes generate diverse white elite interests

1. Frontier settler polity -> elite interest in disposession / assimiatilion -> aggressive paternalistic welfare state for AIAN, social democracy for settlers
2. Jim Crow -> elite interest in exploitation and exclusion -> elite paternalism, malign neglect, hard coercion
3. Metropole settler polity -> elite interests in labor discipline / immig assimilation -> progressive paternalism, strong coercive welfare state for W, hard coercion and contested welfare for Blk

THESE ARE MULTIVARIATE INDICATORS, CAN USE CLUSTERING TO CHECK IT AND MEASURE IT. 

1: MEASURE VARIATION IN CONTEXT, ASSUME CONTEXT PRODUCES INTERESTS. 2: MEASURE VARIATION IN POLICY DEVELOPMENT. 

3 dimensions: frontier, antiBlack, white immig assim (urban)

frontier: {homestead claims, tribal density, https://www.census.gov/dataviz/visualizations/001/}
railrooad (corporate) + homestaed (individual) + morrill (state) - nice three piece approach, more complex and complete story. 


antiblack: {jim crow polit econ (sharecropping), prop black}

urban assim: {urbanization, industrial employment?, urban white immig, log black pop}

Following Wolfe, DuBois, etc, variation in the interests of elites across places (material + cultural) drives variation in processes of racialization across places. The state is a key vector through which racialization is implemented. Early 20th c. saw rapid development and expansion of social state. Can we observe differences in social state developmental trajectories as a function of variation in elite interests in particular racial projects? Are regional differences in social policy regimes a function of the social, demographic, and economic interests of regional elites? 

Stratification in frontier was settler social democracy; flat social relations among settlers, extreme hostility to Native. Stratification in Jim Crow was rigid racial + class hierarchy; extreme wealth concentration and rigid racialized exploitation + social exclusion. Stratification in metropole was more fluid racial + class hierarchy; extreme concentration but porous boundaries, fewer bright lines.

Interests of social policy actors defined within these fields. Bourdieusian historical stuff?

Basic theory though is that interests of elites are racialized as a function of local social relations, and inform social policy development. This can lock in particular racial regimes over time as social policy does work on social groups.

interests can be observed indirectly sometimes, right? homesteading is direct evidence of interest. tenant farming (or land ownership) is direct evidence of interest. industrial urban is tougher, but maybe there we just go indirect and use urbanization + racial demography.

I THINK THIS WORKS. CLUSTER ON INTERESTS + DEMOGRAPHY. OUTCOMES ARE POLICY MEASURES: POLICY OUTCOMES (EG EMPLOYMENT, SPENDING, GROUP QUARTERS POPS, ENROLLMENTS). 

TRY TO DO ONLY A FEW BIG NATIONAL PARAMETRIC TESTS. LOTS OF DESCRIPTIVE SUBSET WORK

TEST 1: clustering, spatial clustering

then TONS of descriptives to paint pictures of regional social / political contexts

TEST 2: regression on outcomes

negative case re: black underdevelopment h1: no social workers in places with large black pops at period of emergence in t1

positive case: white immigrants -> more social workers in t1

```{r read, cache = T}
### read employment data
### full ts of occupations ADD CONSTABLES, THERES A DECENT NUMBER OF THEM
dat_occ<-read_csv("./data/usa_00071.csv") %>% 
  rename_all(tolower) %>% 
  mutate(occ1950 = 
           case_when(
             occ1950 == 79 ~ "socwork",
             occ1950 == 773 ~ "police",
             occ1950 == 771 ~ "police",
             occ1950 == 782 ~ "police",
             occ1950 == 93 ~ "teachers"
           )) %>% 
  group_by(year, statefip, occ1950) %>% 
  summarize(emp = sum(perwt)) %>% 
  pivot_wider(names_from = occ1950, values_from = emp,
              values_fill = 0)
### AK OR HI HERE? check that at IPUMS

# pop data (total, age, race, nativitiy, urban)
dat_immig<-read_csv("./data/usa_00070.csv") %>% 
  rename_all(tolower) %>% 
  group_by(year, statefip) %>% 
  summarize(tot_pop = sum(perwt),
            children = sum((age<18) * perwt),
            white_immig = 
              sum((nativity == 5) * (race == 1) * (hispan == 0) * perwt),
            blk = 
              sum((race == 2) * perwt),
            urban = sum(hhwt * (urban ==2)),
            tot_hh = sum(hhwt)) 
### AK OR HI HERE? check that at IPUMS


### group quarters data, 100% 
gq<-read_csv("./data/usa_00069.csv") %>% 
  rename_all(tolower) %>% 
  filter(age<18) %>% 
  group_by(year, statefip, gqtype) %>% 
  summarize(gq_pop = sum(perwt, na.rm = T)) %>% 
  mutate(gqtype = case_when(
    gqtype == 2 ~ "child_inst_correctional",
    gqtype == 3 ~ "child_inst_mental",
    gqtype == 4 ~ "child_inst_poor_disabled")) %>% 
  filter(gqtype!="other") %>% 
  pivot_wider(names_from = gqtype, values_from = gq_pop,
              values_fill = 0)
### AK OR HI HERE? check that at IPUMS

 
### join
dat <- data.frame(state = state.abb, 
               region = state.region, 
               division = state.division) %>% 
  left_join(state.fips %>% 
              select(fips, abb) %>% 
              distinct() %>% 
              rename(state = abb, statefip = fips)) %>% 
  left_join(dat_immig) %>% 
  left_join(dat_occ) %>% 
  ungroup() %>% 
  left_join(gq)

### homestead act data
#### load in homestead data and boarding school data
### state measure can be cumulative sum of homesteads, that gets at polity
### homesteading data
y_o_s <- read_csv("./data/year_of_statehood.csv") %>% 
  left_join(dat %>% 
              select(state, region) %>% 
              distinct()) 

hs<-read_csv("./data/blm_homesteads_clean.csv") %>% 
  pivot_longer(claims1868:acres1961,
               names_to = "name",
               values_to = "value") %>% 
  mutate(year = str_sub(
    name, start = -4, end = -1),
    type = str_sub(
      name, start = 1, end = -5)) %>% 
  select(-name) %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(value = ifelse(is.na(value),
                        0,
                        value))

### split Dakota Territory values to 0.5 ND, 0.5 SD to preserve time series
hs_dakota<-hs %>% 
  filter(state == "Dakota Territory") %>% 
  mutate(value = value / 2) %>% 
  select(-state)

hs<-hs %>% 
  bind_rows(hs_dakota %>% 
              mutate(state = "North Dakota")) %>% 
  bind_rows(hs_dakota %>% 
              mutate( state = "South Dakota")) %>% 
  filter(state != "Dakota Territory") %>% 
  group_by(state, year, type) %>% 
  summarize(value = sum(value))
  
hs<-hs %>% 
  arrange(state, year) %>% 
  group_by(state, type) %>% 
  mutate(cum_value = cumsum(value)) %>% 
  ungroup()

## expand_grid to add zeroes
### use y_o_s for index
state<-unique(y_o_s$statename)
year<-unique(hs$year)
type<-unique(hs$type)
temp<-expand_grid(state, year, type)

hs<-temp %>% 
  left_join(hs) %>% 
  replace_na(list(value = 0,
                  cum_value = 0))

hs <- hs %>% 
  select(-value) %>% 
  pivot_wider(names_from = type,
              values_from = cum_value,
              names_prefix = "hs_") 

### add ID and pop vars back to hs

y_o_s <- read_csv("./data/year_of_statehood.csv") %>% 
  left_join(dat %>% 
              select(state, region) %>% 
              distinct()) %>% 
  filter(!(is.na(region)))

hs<-hs %>% 
  rename(statename = state) %>% 
  left_join(y_o_s)

#### join cumulative acres / claims onto dat for the valid census years, then carried forward

dat<-dat %>% 
  left_join(hs)
```

# methods

here we are looking at how contexts in post-civil war -> progressive era US related to the emergence of the social state in the us. 

## NOTES ON GEOGRAPHIES and MEASUREMENT

### STATES, TERRITORIES, AND NATIVE LANDS

TALK ABOUT STATES, TERRITORIES, WESTERN EXPANSION. CONTESTATION AND TRANSFORMATION ARE KEY PROCESSES OF COLONIZATION. SETTLER COLONIALISM IS A SPATIAL STRUCTURE, NOT A SETTLED FACT, ESP VISIBLE IN THIS PERIOD. 

STATES ARE WEIRD UNITS, BUT MAP CLEANLY ONTO ADMIN / LEGAL UNITS. TRIBAL NATIONS BOUNDARIES ARE ALSO V USEFUL, AS ARE SUB-STATE ANALYSES (EG CITIES COUNTIES ETC). 

### DIRECT AND PROXY MEASURES FOR ELITE SETTLER INTERESTS

We suggest that regionally-specific political contexts, driven by spatially and temporally varying interests of white settler elites, caused variation in trajectories of welfare state formation across US states. In this study, we explore how three settler colonial political projects mattered for the emergence of the US welfare state: the economic exploitation and social exclusion of Black people from the settler polity, the consolidation of settler political, social, and cultural claims on Indigenous territories, and the incorporation of urban European immigrants into the settler polity. 

The works of settler colonial and racial politics historical and theoretical scholars suggest a straightforward approach to selecting measures that are either a) direct, or b) proxy measures for elite white settler interests given a few assumptions about relationships between population distributions and political processes.

#### Measuring anti-Blackness and post-Reconstruction racial politics

1) POP COMP (BLACK) - VERY CLEAR

  Explain
  
2) jim crow salience

3) 
  
#### Measuring the size, power, and interests of the settler polity in active conflict zones 

2) HOMESTEAD CLAIMS - VERY CLEAR

  Explain
  
3) PRESENCE OF NATIVE LAND HOLDINGS - VERY CLEAR

  Explain
  
#### Measuring the magnitude of social problems Progressive reformers would seek to 'fix'

4) URBANIZATION + IMMIGRANT POP - CLEAR-ISH. HOW DOES THIS RELATE TO SETTLER INTERESTS?

  Explain

# Findings

1) walk through the context variables descriptively
2) walk through the state formation variables descriptively
3) estimate a few multivariate models
4) do I need a DAG + causal ID?

## The distributions of Black populations in the US


```{r blk-ts, fig.cap = "Black population by state 1870-1940"}
p1<-ggplot(dat,
       aes(x = year, y = blk / tot_pop,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  geom_text(data = dat %>% 
              filter(!(is.na(region))) %>% 
              filter(year == 1930),
            aes(x = year,
                y = blk / tot_pop,
                label = state),
            position = position_dodge(width = 8),
            size = 2,
            alpha = 0.7) + 
  labs(subtitle = "Panel 2. Proportion Black",
       y = "Proportion",
       x = "Year") + 
  facet_wrap(~region)

p2<-ggplot(dat,
       aes(x = year, y = blk,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  geom_text(data = dat %>% 
              filter(!(is.na(region))) %>% 
              filter(year == 1930),
            aes(x = year,
                y = blk,
                label = state),
            position = position_dodge(width = 8),
            size = 2,
            alpha = 0.7) + 
  # scale_y_log10() + 
  labs(subtitle = "Panel 1. Black population",
       y = "Count",
       x = "Year") + 
  facet_wrap(~region)

grid.arrange(p2, p1, nrow = 1)
```


```{r}
dat %>% 
  filter(year == 1920) %>% 
  mutate(state = tolower(statename)) %>% 
  ggplot(aes(fill = log(blk))) + 
  geom_map(aes(map_id = state), map = map) + 
  expand_limits(x = map$long, y = map$lat) + 
  scale_fill_continuous(type = "viridis") + 
  theme_void() + 
  theme(legend.position = "bottom")
```

Figure \@ref(fig:blk-ts) shows two sets of time series describing the Black population in US States between 1870 and 1930 using the US Census. Panel 1 shows the size of the Black population in counts, represented on a logarithmic scale to allow for easier comparisons of population order of magnitude. Panel 2 shows the proportion of a state's population reported as Black on the US Census, to allow for comparisons of population composition across places. 

Black populations increased uniformly across all US states between 1870 and 1930 (see panel 1), though there are clear differences in rates of increase and absolute levels across states. For example, in the Northeast region, the primarily rural states of Maine, Vermont, and New Hampshire had relatively small Black populations across the time period. In Maine, reported Black populations were between 300 and 2400 during this period (1% sample data, NO standard errors REPORTED HERE because it's a pain but I'll keep working on it). By contrast, states with large and growing cities, like New York, New Jersey, and Pennsylvania all had large Black populations that grew substantially between 1870 and 1930. For example, Pennsylvania's Black population was recorded at about 70,000 in 1870, and 430,000 in 1930.

Note that some places described in these plots were not admitted as states at the beginning of this time period (CHECK US CENSUS QUALITY IN TERRITORIES), and were intensely contested in military and non-military conflicts between the US government and tribal nations. MORE HERE. HOW DOES CONTESTATION ENTER INTO THE STAT PROCESS? CENSUS IS COUNTING SETTLERS + ENSLAVED, SO THATS STILL VALID FOR CONTEXTS OF SET COL ASSUMING GOOD TERRITORIAL MEASUREMENT (CHECK THIS!).

Similar population trends are evident in the North Central region (commonly referred to as the Midwest). States with large cities, like Illinois, Ohio, Missouri, and Michigan had both relatively high Black populations at the beginning of the period and saw substantial growth in these populations over time. For example, the US Census recorded about 31,000 Black residents in Illinois in 1870. By 1930, the Census recorded about 330,000 Black residents of Illinois. Note that some of these places were not admitted as states at the beginning of this time period. (CHECK US CENSUS QUALITY IN TERRITORIES), and were sites of ongoing military conflicts between the US government and tribal nations.

In the Western Region, states reported uniformly small Black populations at the beginning of this period, with varying (but positive) rates of growth. Note that many of these places were not yet states at the beginning of the time series; only California, Oregon, and Nevada had been admitted as states by 1870. California recorded the largest Black population by the end of the period. The Census records an increase in Black population in California from about 3000 in 1870 to about 84,000 in 1930. Arizona, Colorado, and Washington had smaller but substantial Black populations by the end of the time period, at around 10,000 persons. 

In the Southern Region (which includes all states that seceded to join the former Confederate States of America in addition to Delaware, Maryland, West Virginia, Kentucky, and Oklahoma), Black populations were consistently large during this period, with the largest populations in states in which white elites had enslaved millions of Black people for work in plantation-driven agriculture, like Georgia, Mississippi, and South Carolina. For example, the Census recorded 540,000 Black residents of Georgia in 1870, increasing to 1,100,000 Black residents in 1930. 

Note though, that these increases in population size do not always mirror trends in relative population composition (see Panel 2). During this period, even as Black populations grew dramatically in some Northeastern and Midwestern states during the first Great Migration, proportional population shares of Black residents remained low and relatively stable. In the South, even as Black populations continued to grow in absolute terms, the proportional population share of Black residents was decreasing consistently throughout the region. 

This divergence between absolute and relative population trends illustrates that Black population share likely fails to adequately capture the salience of race for local political contexts. 

IMPORTANCE OF URBAN? ADD EXTRA PLOT HERE? BLK / URBAN?

## The spatial distribution of the frontier settler polity 

### HOMESTEAD ACT

We use data on Homestead Act claims as an indicator of the volume of settlers at the time and place-level seeking to actively dispossess Native Nations of their lands. Data on homestead claims provide useful indicators of both the demographic size of the settler polity (measured as counts of claimants) and the magnitude of their resources (measured as acres claimed). COUPLED WITH WHAT ELSE? 

Figure \@ref(fig:ts-homestead-claims) shows the distribution of Homestead Act claims made by settlers between 1868 and 1961. No homestead claims were completed in the states in the Northeast region. In general, states in the North Central (Midwest) and Western regions had higher volumes of claims, though Oklahoma and Arkansas in the South also saw relatively large numbers of claims. By the end of the Homestead era, Montana had seen the largest number of claimants (151,500), followed by North Dakota (135,448), South Dakota (114,172), Colorado (107,618), and Nebraska (104,260). 


```{r ts-homestead-claims, fig.cap = "Cumulative Homestead act claims by state and year"}
ggplot(hs %>% 
         filter(year < 1940),
       aes(x = year,
           y = hs_claims,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  geom_text(data = hs %>% 
              filter(year == 1935),
            aes(x = year,
                y = hs_claims,
                label = state),
            position = position_nudge(x = 8),
            alpha = 0.7) + 
facet_wrap(~region)  + 
  labs(y = "Number of claims",
       x = "Year",
       subtitle = "") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

### ALTERNATIVE?
# 
# ggplot(hs %>% 
#          filter(year < 1940),
#        aes(x = year,
#            y = hs_claims,
#            group = state,
#            color = region)) + 
#   geom_line(alpha = 0.3) + 
#   geom_text(data = hs %>%
#               filter(year == 1940,
#                      hs_claims > 10000),
#             aes(x = year,
#                 y = hs_claims,
#                 label = state),
#             position = position_nudge(x = 2),
#             size = 3) +
#   geom_line(data = hs %>% 
#               group_by(year, region) %>%
#               filter(year < 1940) %>% 
#               summarize(hs_claims = mean(hs_claims)),
#             aes(x = year, y = hs_claims, color = region,
#                 group = region), linewidth = 2, lty = 2, alpha = 0.7) +
#   labs(y = "Number of claims",
#        x = "Year",
#        subtitle = "Panel 1.") + 
#   theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

```

THIS IS COOL! Look at homestead (as settler polity) plus mode (as boarding school on / off)

LOOK AT ACRES PER CLAIM? GET AT BOTH POP SIZE AND RELATIVE RESOURCES?

```{r}
ggplot(hs %>% 
         filter(year == 1961) %>% 
         mutate(region = factor(region, 
                                levels = c("West", 
                                           "North Central",
                                           "South",
                                           "Northeast"))),
       aes(x = hs_acres / 1e6,
           y = fct_reorder(state, hs_acres))) + 
  geom_point() + 
  labs(x = "Acres claimed (millions)",
       y = "",
       color = "Census Region") + 
  facet_wrap(~region, 
             scales = "free_y")
```

pop / claims ratio is a little funky, but probably useful. can peg to 1940 census. 

WOWZERS. 
20+pct of pop likely had HS claim land in 3 states. 

Wow, let's pull through this. ONE INDICATOR OF SETTLER POLITY. DEmographic base is one dimension - cultures / institutions/ resources also key. but useful!

```{r}
dat %>% 
  filter(year == 1940) %>% 
  mutate(region = factor(region, 
                         levels = c("West", 
                                    "North Central",
                                    "South",
                                    "Northeast"))) %>% 
  mutate(hs_pop = hs_claims / tot_pop) %>% 
  ggplot(aes(x = hs_pop,
             y = fct_reorder(state, hs_pop))) + 
  geom_point() + 
  labs(x = "Cumulative homestead claims per state population, 1940",
       y = "",
       color = "Census Region") + 
  facet_wrap(~region, 
             scales = "free_y")
```

```{r}
dat %>% 
  filter(year == 1940) %>% 
  mutate(hs_pop = hs_claims / tot_pop) %>% 
  mutate(state = tolower(statename)) %>% 
  ggplot(aes(fill = hs_pop)) + 
  geom_map(aes(map_id = state), map = map) + 
  expand_limits(x = map$long, y = map$lat) + 
  scale_fill_continuous(type = "viridis") + 
  theme_void() + 
  theme(legend.position = "bottom")
```

### white immigrants and cities

WRITE IT UP

```{r immig-ts, fig.cap = "White immigrant population by state 1870-1940"}
p1<-ggplot(dat,
       aes(x = year, y = white_immig / tot_pop,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  labs(subtitle = "Proportion white immigrant",
       y = "Proportion",
       x = "Year") + 
  facet_wrap(~region)

p2<-ggplot(dat%>% 
  filter(!(is.na(region))),
       aes(x = year, y = white_immig,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  scale_y_log10() + 
  labs(subtitle = "White immigrant population",
       y = "Count (note log10 axis)",
       x = "Year") + 
  facet_wrap(~region)

grid.arrange(p2, p1, nrow = 1)
```

Relative population share as first generation immigrant declines in NC across period uniformly. In NE, increase until 1920 for most states, then monotonic decline. Low levels in S. Declining levels in W.

Absolute white immigrant pop numbers increasing in NE, Increasing, then plateau in NC, increasing then plateau in W, and stable and low in S. 

### urban

```{r urban-ts, fig.cap = "Urban population by state 1870-1940"}
p1<-ggplot(dat%>% 
  filter(!(is.na(region))),
       aes(x = year, y = urban / tot_hh,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  labs(subtitle = "Proportion of households urban",
       y = "Proportion",
       x = "Year") + 
  facet_wrap(~region)

p2<-ggplot(dat%>% 
  filter(!(is.na(region))),
       aes(x = year, y = urban,
           group = state)) + 
  geom_line(alpha = 0.5) + 
  labs(subtitle = "Number of households urban",
       y = "Count",
       x = "Year")+ 
  facet_wrap(~region)

grid.arrange(p2, p1, nrow = 1)
```

increase in proportion of households in urban across regions

Also clear increase in absolute n of households in urban settings. 


# maps of focal measures



# distributions of policy outcomes

### the distribution of social state capacity building 

CONSIDER GOING 1880 - 1920 to capture period more effectively? no social workers will be in there tho...

we treat police, education, and social work employment as core areas of the domestic social state. what is the name for that? the welfare state? the carceral state? the therapeutic state? that thing. 

let's look at how it played out in the progressive era across states and regions. we are cutting the data at 1900 - 1930, wanting to capture the boom in progressive reforms that started in the late 1890s and continued until the great depression.

First, the full country. How many people were employed in these social regulation / reproduction functions over time per capita?

We use IPUMS 100% census data for 1900 - 1930 to count employment levels nationally and across states. A census taker is counted as a police employee if their code for the IPUMS variable OCC1950 is equal to one of {771 Marshals and constables, 773 Policemen and detectives, 782 Sheriffs and bailiffs}; coded social worker if OCC1950 is coded 079 Social and welfare worker; and coded teacher if OCC1950 is equal to 093 Teachers (n.e.c.). We convert these into employment rates per 1,000 population using the full population at the state (and nation) level. 

```{r emp-ts-plot, fig.cap="Employment rates per 1000 population 1900 - 1930 (US States, PUMS data)"}
dat %>% 
  filter(year > 1880) %>% 
  group_by(state, year) %>% 
  summarize(police = sum(police) / sum(tot_pop) * 1e3,
            teachers = sum(teachers) / sum(tot_pop) * 1e3,
            socworkers = sum(socwork) / sum(tot_pop) * 1e3) %>% 
  pivot_longer(cols = police:socworkers,
               names_to = "name",
               values_to = "employment")  %>%  
  filter(year < 1940) %>% 
  ggplot(aes(x = year, y = employment)) + 
  geom_line(aes(group = state), alpha = 0.2) + 
  geom_line(data = dat %>% ### add national line
              group_by(year, region) %>%
              filter(year > 1880, year < 1940) %>% 
              summarize(police = sum(police, na.rm=T) / sum(tot_pop, na.rm=T) * 1e3,
                        teachers = sum(teachers, na.rm=T) / sum(tot_pop, na.rm=T) * 1e3,
                        socworkers = sum(socwork, na.rm=T) / sum(tot_pop, na.rm=T) * 1e3) %>%
              pivot_longer(cols = police:socworkers,
                           names_to = "name",
                           values_to = "employment"),
  aes(x = year, y = employment, color = region), linewidth = 1.2) +
  facet_wrap(~name) + 
  scale_y_log10() + 
  labs(subtitle = "note variable y axis scales, national average dashed")
```

During this period, we see very clear upward trajectories in employment in each of three categories: police, social workers, and teachers. At the national level, police employment nearly doubled from about 0.7 per 1,000 in 1900 to 1.3 per 1,000 population in 1930. 
Data on social workers shows an employment rate of 5 per 10,000 in 1900 nationally doubling to a rate of 1 per 1,000 by 1930. Teachers shows 1900 rate of 5.5 per 1,000, 1930 of 8.6 per 1,000. 

Figure 1 shows substantial variation in state employment initial values and trajectories during this period (thin solid lines in fig 1). There is a clear upward trajectory in employment rates for each class of worker. Social workers experienced the largest relative rate of growth (a feature of the near-zero initial rate of employment in most states), while teachers experience the largest absolute rate of growth nationally.  

```{r tab1}
### tabular mean / variance
t<-dat %>% 
  group_by(state, year) %>% 
  summarize(police = sum(police) / sum(tot_pop) * 1e3,
            teachers = sum(teachers) / sum(tot_pop) * 1e3,
            socworkers = sum(socwork) / sum(tot_pop) * 1e3) %>% 
  pivot_longer(cols = police:socworkers,
               names_to = "name",
               values_to = "employment")  %>% 
  group_by(year, name) %>% 
  summarize(mean = mean(employment, na.rm=T),
                        sd = sd(employment, na.rm=T)) %>% 
  filter(year == 1900 | year == 1930) 

knitr::kable(t, 
             caption = "Table 1. Mean and variance of state employment rates 1900 - 1930",
             digits = 3)
```

There is substantial heterogeneity in 1900 values for social policy employment across states. The standard deviation of social work employment is greater than the mean value of social work employment. For police, the sd is half the value of the mean, and for teachers it is one third of the value of the mean. At 1930, the sd for social work employment had increased dramatically, as had the sd for police employment. The sd for teacher employment was relatively stable over the period. These features show clear variation in starting conditions of employment during the period and suggest variation in trajectories of growth over the period. 

Some of this heterogeneity in starting conditions and trajectories is likely a feature of regional variation in policy configurations (which we will seek to explain variation in racial political economy as we proceed). 

```{r emp-ts-region, fig.cap = "Employment rates per 1000 population 1900 - 1930 (US States, PUMS data)"}

### CUT

dat %>% 
  filter(!(is.na(region))) %>% 
  group_by(region, year) %>% 
  summarize(police = sum(police) / sum(tot_pop) * 1e3,
            teachers = sum(teachers) / sum(tot_pop) * 1e3,
            socworkers = sum(socwork) / sum(tot_pop) * 1e3) %>% 
  pivot_longer(cols = police:socworkers,
               names_to = "name",
               values_to = "employment")  %>%  
  ggplot(aes(x = year, y = employment, 
             color = region)) + 
  geom_line() + 
  facet_wrap(~name, scales = "free", ncol = 3) + 
  labs(subtitle = "note variable y axis scales")
```

In figure 2 we subset the data from figure 1 to regional averages using the four-region US Census classification for states. Clear patterns are visible in the data here. On average, states in the US South had lower employment rates for all categories of social policy system employees. Northeastern states had the highest levels of police and social work employment across the period. And states in the West and North Central (Midwest) had the highest average rates of teacher employment. However, there is also substantial sub-regional variation in employment rates, as shown in Figure 3.

```{r emp-ts-region2, fig.cap = "Employment rates per 1000 population 1900 - 1930 (US States, PUMS data)"}
dat %>% 
  group_by(state, region, year) %>% 
  filter(!is.na(region)) %>% 
  summarize(police = sum(police) / sum(tot_pop) * 1e3,
            teachers = sum(teachers) / sum(tot_pop) * 1e3,
            socworkers = sum(socwork) / sum(tot_pop) * 1e3) %>% 
  pivot_longer(cols = police:socworkers,
               names_to = "name",
               values_to = "employment")  %>%  
  ggplot(aes(x = year, y = employment, group = state)) + 
  geom_line(alpha = 0.3) + 
  facet_wrap(region~name, scales = "free", ncol = 3) + 
  labs(subtitle = "note variable y axis scales")
```

Figure 3 shows how states within regions still exhibit substantial variation in both initial employment rates and growth trajectories between 1900 and 1930 for social policy employment. Again, note that social work employment began at or near zero in 1900 in all states as the social work was built as a concrete profession. In the South a cluster of low-employment states drive the regional trend for social work and police, while a cluster of high employment states appear to drive the trend for social work employment in the Northeast, North Central, and West. 

```{r emp-map, fig.cap = "Employment rates per 1,000 1930"}
t<-dat %>% 
  group_by(state, region, year) %>% 
  summarize(police = sum(police) / sum(tot_pop) * 1e3,
            teachers = sum(teachers) / sum(tot_pop) * 1e3,
            socworkers = sum(socwork) / sum(tot_pop) * 1e3) %>% 
  pivot_longer(cols = police:socworkers,
               names_to = "name",
               values_to = "employment")  %>%  
  filter(year == 1930) 

p1<-plot_usmap(data = t %>% 
             filter(name == "socworkers"),
           values = "employment")+ 
  scale_fill_viridis_c() + 
  labs(title = "social workers",
       fill = "") + 
  theme(legend.position = "bottom")

p2<-plot_usmap(data = t %>% 
             filter(name == "teachers"),
           values = "employment")+ 
  scale_fill_viridis_c() + 
  labs(title = "teachers",
       fill = "") + 
  theme(legend.position = "bottom")

p3<-plot_usmap(data = t %>% 
             filter(name == "police"),
           values = "employment")+ 
  scale_fill_viridis_c() + 
  labs(title = "police per 1,000",
       fill = "") + 
  theme(legend.position = "bottom")

grid.arrange(p1, p2, p3, ncol = 3)
  
```

Figure 4 shows these distributions as state choropleth maps for 1930 employment per 1,000. It clearly shows the geographic distribution of clusters of high and low employment states. Northeastern states like New York, New Jersey, and Massachusetts had very high levels of police and social work employment. Midwestern states like Minnesota, Michigan, and Illinois also had high social work and police employment, as did California. Midwestern and Plains states like North and South Dakota, Wyoming, and Iowa had especially high levels of teacher employment. 

Employment provides a measure of the magnitude of state and private investment in social control and social services (aside from transfers - think about distinction b/w hands on and redistribution). But this is one dimension of infrastructure. Given the ambiguity in 'social state capacity', we are working multiple measures to think this through. 

#### kids in institutional group quarters

Next, let's turn to reach of social state policy systems. One way to get at that is through the existence and utilization of era-specific policy institutions. Here, we will look at the distribution of children recorded as being housed in 'institutional group quarters' on the 1900 - 1930 decennial censuses. To improve the quality of measurement, I use the 100% decennial data for 1900, 1920, 1930 and 1940. The 1910 census data available through IPUMS only includes detailed group quarters information on the 1% and 1.4% samples and after exploratory work, they do not appear to be continuous with the 100% data. I exclude 1910 data for now. 

Group quarters indicate non-traditional housing situations (e.g. not in a house or apartment). Here, we subset this group to include only children recorded as residents of 'correctional institutions', 'mental institutions', or 'institutions for the elderly, handicapped, and poor'. This excludes children recorded as living in rooming houses, military housing, other non-institutional settings. Our goal here is to capture the magnitude of efforts by both public and private actors to coercively or therapeutically detain children for purposes of social control or social welfare.   


```{r gq-ts, fig.cap = "Children in institutional group quarters 1900 - 1930"}
dat %>% 
  filter(year!=1910,
         !(is.na(region))) %>% 
  mutate(across(child_inst_correctional:child_inst_poor_disabled, 
                ~ .x/children * 1e3)) %>% 
  pivot_longer(cols = child_inst_correctional:child_inst_poor_disabled,
               names_to = "type",
               values_to = "pop") %>% 
  ggplot(aes(x = year, y = pop)) + 
  geom_line(aes(group = state),
            alpha = 0.2) + 
  geom_line(data = dat %>% ### add national line
              filter(year!=1910,
                     !(is.na(region))) %>%
              group_by(year) %>% 
              summarize(across(child_inst_correctional:child_inst_poor_disabled, 
                               ~ sum(.x, na.rm=T)/sum(children, na.rm=T) * 1e3)) %>% 
              pivot_longer(cols = child_inst_correctional:child_inst_poor_disabled,
                           names_to = "type",
                           values_to = "pop"),            
            aes(x = year, y = pop), linewidth = 2, lty = 2) + 
  facet_wrap(~type, scales = "free") + 
  labs(y = "institutional population per 1,000 children",
       subtitle = "note varying y axes. National average dashed, state values solid")

```

These plots strongly suggest that there are measurement artifacts present in the census data for these measures. Many states have broken time series with zeroes observed in 1920 between non-zero rates in 1900 and 1930, or large jumps between periods that defy expected linear growth patterns that revert in later periods. I think it makes sense to treat these with caution. 

I'd like to use total group quarters, but it includes rooming houses, which are a huge proportion of the count. COULD JUST USE GQ == 3 (Institutions). That may be the ticket. 


```{r gq-box, fig.cap = "Children in institutional group quarters 1930"}
dat %>% 
  filter(year == 1930) %>% 
  mutate(across(child_inst_correctional:child_inst_poor_disabled, 
          ~ .x/children * 1e3)) %>% 
  pivot_longer(cols = child_inst_correctional:child_inst_poor_disabled,
               names_to = "type",
               values_to = "pop") %>% 
  ggplot(aes(x = type, y = pop, 
             color = region)) + 
  geom_boxplot()



```

### agents data eda

```{r}
agents<-read_csv("./data/AGENTS_DATA_COLLECTION.csv")

agents1895<-agents %>% 
  filter(YEAR == 1895) 

state_counts95<-agents1895 %>% 
  group_by(`STATE/SUPERINTENDENCY`) %>% 
  summarize(enrolled = sum(STUDENTS_ENROLL, na.rm=T))
```

NEED A STATE MAPPING ST SOME POINT
I WANT TO GET STUDENT POPS BY STATE...

USE BIA DATA FOR NOW FOR RESIDENTIAL / NON

```{r}
bs<-read_csv("./data/Boarding_Schools.csv")

bs <- bs %>% 
  group_by(State, ST_Reservation) %>% 
  summarize(n = n()) %>% 
  filter(!(is.na(ST_Reservation)))
```
